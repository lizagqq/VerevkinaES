# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ6: –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ –≤ MPI

## üéØ –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–û—Å–≤–æ–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–æ–ø–æ–ª–æ–≥–∏–π MPI. –ò–∑—É—á–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ Create_cart, Shift, Sendrecv_replace. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–µ–∫–∞—Ä—Ç–æ–≤—É —Ç–æ–ø–æ–ª–æ–≥–∏—é "—Ç–æ—Ä" –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤.

**–û—Ü–µ–Ω–∫–∞:** –•–æ—Ä–æ—à–æ (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ß–∞—Å—Ç–∏ 1 –∏ 2 + –±–∞–∑–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lab6/
‚îú‚îÄ‚îÄ cart_topology_basic.py      # –ß–∞—Å—Ç—å 1: –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ cg_virtual_topology.py      # –ß–∞—Å—Ç—å 2: CG —Å —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π
‚îú‚îÄ‚îÄ generate_data.py            # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ –û–¢–ß–ï–¢.md                   # –û—Ç—á—ë—Ç (Markdown)
‚îú‚îÄ‚îÄ –û–¢–ß–ï–¢.pdf                  # –û—Ç—á—ë—Ç (PDF)
‚îî‚îÄ‚îÄ README.md                  # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```bash
python generate_data.py
```

### 2. –ß–∞—Å—Ç—å 1: –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –¢–æ–ª—å–∫–æ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ P (1, 4, 9, 16, ...)

```bash
# –°–µ—Ç–∫–∞ 2√ó2
mpiexec -n 4 python cart_topology_basic.py

# –°–µ—Ç–∫–∞ 3√ó3
mpiexec -n 9 python cart_topology_basic.py

# –°–µ—Ç–∫–∞ 4√ó4
mpiexec -n 16 python cart_topology_basic.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞—ë—Ç –¥–µ–∫–∞—Ä—Ç–æ–≤—É —Ç–æ–ø–æ–ª–æ–≥–∏—é "—Ç–æ—Ä"
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ—Å–µ–¥–µ–π —á–µ—Ä–µ–∑ Shift
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–ª—å—Ü–µ–≤–æ–π –æ–±–º–µ–Ω —Å Sendrecv_replace

### 3. –ß–∞—Å—Ç—å 2: CG —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π

```bash
mpiexec -n 4 python cg_virtual_topology.py
mpiexec -n 9 python cg_virtual_topology.py
```

## üìä –ö–ª—é—á–µ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ (1000√ó1000, 16 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)

| –ú–µ—Ç–æ–¥ | –í—Ä–µ–º—è | –£—Å–∫–æ—Ä–µ–Ω–∏–µ | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
|-------|-------|-----------|---------------|
| Lab3 (–±–∞–∑–æ–≤—ã–π) | 0.876 —Å | 6.66x | 41.6% |
| Lab5 (2D) | 0.478 —Å | 12.20x | 76.3% |
| **Lab6 (—Ç–æ–ø–æ–ª–æ–≥–∏—è)** | **0.623 —Å** | **9.36x** | **58.5%** |

**–í—ã–≤–æ–¥—ã:**
- Lab6 **–ª—É—á—à–µ Lab3 –Ω–∞ 29%**
- Lab6 **–º–µ–¥–ª–µ–Ω–Ω–µ–µ Lab5 –Ω–∞ 23%**
- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑-–∑–∞ O(P) –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ Sendrecv

## üî¨ –¢–µ–æ—Ä–∏—è

### –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å–µ–¥–µ–π
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –ß–∏—Ç–∞–µ–º—ã–π –∫–æ–¥

### –î–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è "—Ç–æ—Ä"

```
–°–µ—Ç–∫–∞ 3√ó3 —Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–º–∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏:

0 ‚Üê‚Üí 1 ‚Üê‚Üí 2 ‚Üê‚Üí 0  (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –∫–æ–ª—å—Ü–æ)
‚Üï    ‚Üï    ‚Üï
3 ‚Üê‚Üí 4 ‚Üê‚Üí 5 ‚Üê‚Üí 3
‚Üï    ‚Üï    ‚Üï
6 ‚Üê‚Üí 7 ‚Üê‚Üí 8 ‚Üê‚Üí 6
‚Üï    ‚Üï    ‚Üï
0 ‚Üê‚Üí 1 ‚Üê‚Üí 2    (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –∫–æ–ª—å—Ü–æ)
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**Create_cart:**
```python
comm_cart = comm.Create_cart(
    dims=[num_row, num_col],
    periods=[True, True],  # –¢–æ—Ä
    reorder=True           # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è MPI
)
```

**Shift:**
```python
# –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ—Å–µ–¥–∏
up, down = comm_cart.Shift(direction=0, disp=1)

# –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–æ—Å–µ–¥–∏
left, right = comm_cart.Shift(direction=1, disp=1)
```

**Sendrecv_replace:**
```python
comm_cart.Sendrecv_replace(
    buf,
    dest=right,
    source=left
)
```

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å–µ–¥–µ–π  
‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è MPI:** –ü–∞—Ä–∞–º–µ—Ç—Ä reorder  
‚úÖ **–ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å:** –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã  
‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ deadlock:** Sendrecv_replace –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç—Å—è P = k‚ÇÅ √ó k‚ÇÇ:** –ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ –¥–ª—è 2D  
‚ö†Ô∏è **O(P) –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** Sendrecv –º–µ–¥–ª–µ–Ω–Ω–µ–µ Allreduce –¥–ª—è –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
‚ö†Ô∏è **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:** –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏  
‚ö†Ô∏è **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ù–µ—Ç –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π

## üìà –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –£—Å–ª–æ–≤–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---------|--------------|
| –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ | ‚úÖ –¢–æ–ø–æ–ª–æ–≥–∏—è |
| –û–±–º–µ–Ω —Ç–æ–ª—å–∫–æ —Å —Å–æ—Å–µ–¥—è–º–∏ | ‚úÖ –¢–æ–ø–æ–ª–æ–≥–∏—è |
| –ú–∞–ª—ã–µ –¥–∞–Ω–Ω—ã–µ | ‚ùå –õ—É—á—à–µ Allreduce |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ | ‚úÖ –¢–æ–ø–æ–ª–æ–≥–∏—è |
| –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π P | ‚ùå –ù—É–∂–Ω–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞ |

## üõ† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.8+
- mpi4py 3.1+
- NumPy 1.21+
- OpenMPI 4.1+

## üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞

1. **–¢–µ–æ—Ä–∏—è** (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏, –¥–µ–∫–∞—Ä—Ç–æ–≤–∞ —Ç–æ–ø–æ–ª–æ–≥–∏—è, —Ç–æ—Ä)
2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è** (Create_cart, Shift, Sendrecv_replace)
3. **–ß–∞—Å—Ç—å 1** (–∫–æ–ª—å—Ü–µ–≤–æ–π –æ–±–º–µ–Ω)
4. **–ß–∞—Å—Ç—å 2** (CG —Å —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π)
5. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã** (3 –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö)
6. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** (Lab3, Lab5, Lab6)
7. **–ê–Ω–∞–ª–∏–∑** (–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
8. **10 –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤**

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

- ‚úÖ **–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ:** –ß–∞—Å—Ç—å 1 (–±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- ‚úÖ **–•–æ—Ä–æ—à–æ:** –ß–∞—Å—Ç–∏ 1 –∏ 2 + –±–∞–∑–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
- ‚ùå **–û—Ç–ª–∏—á–Ω–æ:** + –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–°—Ç–∞—Ç—É—Å:** –•–æ—Ä–æ—à–æ (–ß–∞—Å—Ç–∏ 1 –∏ 2 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã)

## üéì –í—ã–≤–æ–¥—ã

1. **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ —É–ø—Ä–æ—â–∞—é—Ç –∫–æ–¥** (Shift vs —Ä—É—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è)
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è** (–º–µ–∂–¥—É Lab3 –∏ Lab5)
3. **Sendrecv_replace –∏–º–µ–µ—Ç O(P) –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** (–º–µ–¥–ª–µ–Ω–Ω–µ–µ Allreduce)
4. **–£—Å–∫–æ—Ä–µ–Ω–∏–µ 9.36x –Ω–∞ 16 –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö** ‚Äî —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
5. **Allreduce —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –¥–ª—è –º–∞–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

---

**–†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ –æ—Ü–µ–Ω–∫—É "–•–û–†–û–®–û"**
